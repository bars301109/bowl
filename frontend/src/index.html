<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Akylman Quiz Bowl ‚Äî –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä –ø–æ –∑–Ω–∞–Ω–∏—è–º –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–æ–≤.">
  <meta name="keywords" content="quiz, —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ, –∑–Ω–∞–Ω–∏—è, —à–∫–æ–ª—å–Ω–∏–∫–∏, –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω">
  <title>Akylman Quiz Bowl</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@500;600;700&family=Tangerine:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <link rel="icon" href="images/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="images/favicon.png">
</head>
<body>
  <header class="header">
    <div class="container">
      <a href="/" class="logo">
        <img src="images/logo.png" alt="Akylman" width="120" height="48" loading="eager" fetchpriority="high">
      </a>
      <nav class="nav">
        <a href="/" data-i18n="nav.home">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/register" data-i18n="nav.register" id="nav-register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        <a href="/login" data-i18n="nav.login" id="nav-login">–í—Ö–æ–¥</a>
        <a href="/team" id="nav-profile" style="display:none;" data-i18n="nav.profile">–ö–∞–±–∏–Ω–µ—Ç –∫–æ–º–∞–Ω–¥—ã</a>
        <a href="javascript:void(0)" id="nav-logout" style="display:none; cursor:pointer;" onclick="logout()" data-i18n="nav.logout">–í—ã—Ö–æ–¥</a>
      </nav>
      <div class="lang-switcher">
        <button class="lang-btn" data-lang="ru">–†–£</button>
        <button class="lang-btn" data-lang="ky">–ö–´</button>
      </div>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="container">
        <div class="hero-content">
          <div class="hero-welcome-text">Welcome to</div>
          <h1 data-i18n="hero.title1">Akylman Quiz Bowl</h1>
          <p class="hero-subtitle" data-i18n="hero.subtitle">–î–ª—è —É—á–µ–Ω–∏–∫–æ–≤ —Å—Ä–µ–¥–Ω–µ–π –∏ —Å—Ç–∞—Ä—à–µ–π —à–∫–æ–ª—ã</p>
          <div class="hero-cta">
            <a href="/register" class="btn btn-primary" data-i18n="hero.cta">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
            <a href="#cats" class="btn btn-outline" data-i18n="cats.title">–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ</a>
          </div>
        </div>
      </div>
    </section>

    <section id="about" class="section">
      <div class="container">
        <h2 class="section-title" data-i18n="about.title">–û —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–∏</h2>
        <div class="cards-grid">
          <div class="card">
            <div class="card-icon">üìù</div>
            <h3 data-i18n="about.prelim">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—É–Ω–¥</h3>
            <p data-i18n="about.prelim.desc">–û–Ω–ª–∞–π–Ω-—Ç–µ—Å—Ç: –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä –∏ –∫–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç</p>
          </div>
          <div class="card">
            <div class="card-icon">üéØ</div>
            <h3 data-i18n="about.semi">–ü–æ–ª—É—Ñ–∏–Ω–∞–ª</h3>
            <p data-i18n="about.semi.desc">–ñ–∏–≤—ã–µ –±–ª–∏—Ü-–≤–æ–ø—Ä–æ—Å—ã –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏</p>
          </div>
          <div class="card">
            <div class="card-icon">üèÜ</div>
            <h3 data-i18n="about.final">–§–∏–Ω–∞–ª</h3>
            <p data-i18n="about.final.desc">–§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞—É–Ω–¥ —Å –ª—É—á—à–∏–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏</p>
          </div>
        </div>
      </div>
    </section>

    <section class="section section-alt">
      <div class="container">
        <h2 class="section-title" data-i18n="how.title">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</h2>
        <div class="features-grid">
          <div class="feature">
            <h3 data-i18n="how.team">–†–∞–∑–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã</h3>
            <p data-i18n="how.team.desc">3‚Äì6 —á–µ–ª–æ–≤–µ–∫ –∏–∑ –æ–¥–Ω–æ–π —à–∫–æ–ª—ã</p>
          </div>
          <div class="feature">
            <h3 data-i18n="how.cats">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
            <div id="cats-list"></div>
          </div>
          <div class="feature">
            <h3 data-i18n="how.format">–§–æ—Ä–º–∞—Ç</h3>
            <p data-i18n="how.format.desc">–≠—Ç–∞–ø—ã 1 –∏ 2 –ø—Ä–æ–≤–æ–¥—è—Ç—Å—è –≤ –æ–Ω–ª–∞–π–Ω-—Ñ–æ—Ä–º–∞—Ç–µ. –¢—Ä–µ—Ç–∏–π —ç—Ç–∞–ø –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –≤ –æ—Ñ—Ñ–ª–∞–π–Ω-—Ñ–æ—Ä–º–∞—Ç–µ.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="container">
        <h2 class="section-title" data-i18n="timeline.title">–¢–∞–π–º–ª–∞–π–Ω</h2>
        <div class="timeline">
          <div class="timeline-item timeline-online">
            <div class="timeline-marker"></div>
            <div class="timeline-content">
              <h3 class="timeline-title" data-i18n="timeline.stage1.title">–≠—Ç–∞–ø 1 - –û—Ç–±–æ—Ä–æ—á–Ω—ã–π —Ç—É—Ä</h3>
              <p class="timeline-description" data-i18n="timeline.stage1.desc">–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –æ–Ω–ª–∞–π–Ω-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º. –£—á–∞—Å—Ç–Ω–∏–∫–∏ –æ—Ç–≤–µ—á–∞—é—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º –∏ –∫–æ—Ä–æ—Ç–∫–∏–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏. –ü–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —ç—Ç–æ–≥–æ —ç—Ç–∞–ø–∞ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∫–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–π–¥—É—Ç –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥.</p>
              <div class="timeline-date" id="d1">15-–¥–µ–∫–∞–±—Ä—å, 2025-–∂—ã–ª</div>
            </div>
          </div>
          <div class="timeline-item timeline-online">
            <div class="timeline-marker"></div>
            <div class="timeline-content">
              <h3 class="timeline-title" data-i18n="timeline.stage2.title">–≠—Ç–∞–ø 2 - –ü–æ–ª—É—Ñ–∏–Ω–∞–ª</h3>
              <p class="timeline-description" data-i18n="timeline.stage2.desc">–≠—Ç–∞–ø –≤—ã—è–≤–ª—è–µ—Ç –ª—É—á—à–∏–µ –∫–æ–º–∞–Ω–¥—ã —Å—Ä–µ–¥–∏ —É–∂–µ —É—Å–ø–µ—à–Ω—ã—Ö. –ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –æ–Ω–ª–∞–π–Ω-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏. –ö–æ–º–∞–Ω–¥—ã —Å–æ—Ä–µ–≤–Ω—É—é—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, –æ—Ç–≤–µ—á–∞—è –Ω–∞ –±–ª–∏—Ü-–≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∑–Ω–∞–Ω–∏–π.</p>
              <div class="timeline-date" id="d2">20-–¥–µ–∫–∞–±—Ä—å, 2025-–∂—ã–ª</div>
            </div>
          </div>
          <div class="timeline-item timeline-final">
            <div class="timeline-marker"></div>
            <div class="timeline-content">
              <h3 class="timeline-title" data-i18n="timeline.stage3.title">–≠—Ç–∞–ø 3 - –§–∏–Ω–∞–ª</h3>
              <p class="timeline-description" data-i18n="timeline.stage3.desc">–§–∏–Ω–∞–ª –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –≤ –æ—Ñ—Ñ–ª–∞–π–Ω —Ñ–æ—Ä–º–∞—Ç–µ –≤ –ü—Ä–µ–∑–∏–¥–µ–Ω—Ç—Å–∫–æ–º –ª–∏—Ü–µ–µ ¬´–ê–∫—ã–ª–º–∞–Ω¬ª (–≥–æ—Ä–æ–¥ –ß–æ–ª–ø–æ–Ω-–ê—Ç–∞). –ò—Ç–æ–≥–æ–≤—ã–π —Ç–µ—Å—Ç –º–µ–∂–¥—É –ª—É—á—à–∏–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –ø–æ–ª—É—Ñ–∏–Ω–∞–ª–∞. –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ –æ–±—â–µ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –Ω–∞–±—Ä–∞–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤.</p>
              <p class="timeline-place" id="finalPlace">–û—Ñ—Ñ–ª–∞–π–Ω –≤ "–ê–∫—ã–ª–º–∞–Ω"</p>
              <div class="timeline-date" id="d3">5-—è–Ω–≤–∞—Ä—å, 2026-–∂—ã–ª</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="cats" class="section section-alt">
      <div class="container">
        <h2 class="section-title" data-i18n="cats.title">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
        <div class="categories-grid" id="catsGrid"></div>
      </div>
    </section>

    <section class="section">
      <div class="container">
        <h2 class="section-title">–ì–∞–ª–µ—Ä–µ—è</h2>
        <div class="gallery-carousel">
          <div class="carousel-wrapper">
            <div class="carousel-track">
              <figure class="carousel-item">
                <img src="images/gallery/akylman-campus.png" alt="Akylman campus" width="600" height="400" loading="lazy" decoding="async">
              </figure>
              <figure class="carousel-item">
                <img src="images/gallery/akylman-2.jpg" alt="Akylman visitors" width="600" height="400" loading="lazy" decoding="async">
              </figure>
              <figure class="carousel-item">
                <img src="images/gallery/akylman-3.jpg" alt="Akylman opening" width="600" height="400" loading="lazy" decoding="async">
              </figure>
            </div>
          </div>
          <button class="carousel-btn carousel-prev" aria-label="Previous slide">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <button class="carousel-btn carousel-next" aria-label="Next slide">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
          <div class="carousel-dots"></div>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container footer-inner">
      <div class="footer-bottom">
        <div class="footer-meta">
          <p class="footer-student-note" data-i18n="footer.student_project">
            –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç ‚Äî —É—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç, —Å–æ–∑–¥–∞–Ω–Ω—ã–π —É—á–µ–Ω–∏–∫–∞–º–∏ 10 –∫–ª–∞—Å—Å–∞ –ü—Ä–µ–∑–∏–¥–µ–Ω—Ç—Å–∫–æ–≥–æ –ª–∏—Ü–µ—è ¬´–ê–∫—ã–ª–º–∞–Ω¬ª.
          </p>
          <p class="footer-copy">
            &copy; 2025 Akylman Presidential School. <span data-i18n="footer.rights">–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</span>
          </p>
        </div>
        <div class="footer-right">
          <div class="footer-cta-inline">
            <span class="footer-cta-inline-title" data-i18n="footer.cta_title">–ê–∫—ã–ª–º–∞–Ω–≥–∞ —Å–∞–ø–∞—Ä –∞–ª—ã“£—ã–∑!</span>
            <a href="/register" class="footer-cta-link" data-i18n="footer.cta_button">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É</a>
          </div>
          <div class="footer-social">
            <a href="https://www.instagram.com/akylman.presidential_school/" target="_blank" rel="noopener noreferrer" aria-label="Akylman Presidential School Instagram">
              <span class="sr-only">Instagram</span>
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <linearGradient id="igGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="#f58529"/>
                  <stop offset="30%" stop-color="#dd2a7b"/>
                  <stop offset="60%" stop-color="#8134af"/>
                  <stop offset="100%" stop-color="#515bd4"/>
                </linearGradient>
                <rect x="2" y="2" width="20" height="20" rx="5" ry="5" fill="url(#igGradient)"></rect>
                <circle cx="12" cy="12" r="4.5" fill="none" stroke="#fff" stroke-width="1.7"></circle>
                <circle cx="17" cy="7" r="1.1" fill="#fff"></circle>
              </svg>
            </a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <script src="js/i18n.js"></script>
  <script>
    function addOrnaments() {
      const ornaments = ['orn-1.png', 'orn-2.png'];
      const horizontalOpposite = {
        'top-left': 'top-right',
        'top-right': 'top-left',
        'bottom-left': 'bottom-right',
        'bottom-right': 'bottom-left'
      };
      
      const sections = document.querySelectorAll('section:not(.hero)');
      const corners = ['top-left', 'top-right', 'bottom-left', 'bottom-right'];
      let prevCorner = null;
      
      sections.forEach((section, index) => {
        const ornament = ornaments[index % 2];
        
        let corner;
        if (prevCorner) {
          corner = horizontalOpposite[prevCorner];
        } else {
          corner = corners[Math.floor(Math.random() * corners.length)];
        }
        
        prevCorner = corner;
        
        const ornDiv = document.createElement('div');
        ornDiv.className = `ornament ${corner}`;
        ornDiv.style.backgroundImage = `url('/images/${ornament}')`;
        section.appendChild(ornDiv);
      });
    }
    
    addOrnaments();
    
    // Initialize language switcher when AkylI18n is ready
    function initLanguageSwitcher() {
      if (typeof AkylI18n !== 'undefined' && AkylI18n.initSwitcher) {
        AkylI18n.initSwitcher();
      } else {
        setTimeout(initLanguageSwitcher, 50);
      }
    }
    initLanguageSwitcher();
    
    function updateNavBar() {
      const token = localStorage.getItem('akylman_token');
      const registerLink = document.getElementById('nav-register');
      const loginLink = document.getElementById('nav-login');
      const profileLink = document.getElementById('nav-profile');
      const logoutLink = document.getElementById('nav-logout');
      
      if (token) {
        registerLink.style.display = 'none';
        loginLink.style.display = 'none';
        profileLink.style.display = 'block';
        logoutLink.style.display = 'block';
      } else {
        registerLink.style.display = 'block';
        loginLink.style.display = 'block';
        profileLink.style.display = 'none';
        logoutLink.style.display = 'none';
      }
    }
    
    function logout() {
      if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
        localStorage.removeItem('akylman_token');
        localStorage.removeItem('team');
        updateNavBar();
        window.location.href = '/';
      }
    }
    
    updateNavBar();
    
    function formatDate(dateStr, lang = 'ru') {
      if (!dateStr) return dateStr;
      
      const monthsRu = ['—è–Ω–≤–∞—Ä—è', '—Ñ–µ–≤—Ä–∞–ª—è', '–º–∞—Ä—Ç–∞', '–∞–ø—Ä–µ–ª—è', '–º–∞—è', '–∏—é–Ω—è', '–∏—é–ª—è', '–∞–≤–≥—É—Å—Ç–∞', '—Å–µ–Ω—Ç—è–±—Ä—è', '–æ–∫—Ç—è–±—Ä—è', '–Ω–æ—è–±—Ä—è', '–¥–µ–∫–∞–±—Ä—è'];
      const monthsKy = ['—è–Ω–≤–∞—Ä—è', '—Ñ–µ–≤—Ä–∞–ª—è', '–º–∞—Ä—Ç–∞', '–∞–ø—Ä–µ–ª—è', '–º–∞—è', '–∏—é–Ω—è', '–∏—é–ª—è', '–∞–≤–≥—É—Å—Ç–∞', '—Å–µ–Ω—Ç—è–±—Ä—è', '–æ–∫—Ç—è–±—Ä—è', '–Ω–æ—è–±—Ä—è', '–¥–µ–∫–∞–±—Ä—å'];
      
      let date;
      if (dateStr.includes('-') && !dateStr.includes(',')) {
        const [year, month, day] = dateStr.split('-');
        date = new Date(year, parseInt(month) - 1, day);
      } else {
        date = new Date(dateStr);
      }
      
      if (isNaN(date.getTime())) return dateStr;
      
      const d = date.getDate();
      const m = date.getMonth();
      const y = date.getFullYear();
      
      const months = lang === 'ky' ? monthsKy : monthsRu;
      const yearSuffix = lang === 'ky' ? '-–∂—ã–ª' : '–≥.';
      
      return `${d}-${months[m]}, ${y}${yearSuffix}`;
    }
    
    async function renderSettings() {
      try {
        const s = await fetch('/api/settings').then(r => r.json());
        const lang = AkylI18n.getLang();
        if (s) {
          if (s.day1_date) document.getElementById('d1').textContent = formatDate(s.day1_date, lang);
          if (s.day2_date) document.getElementById('d2').textContent = formatDate(s.day2_date, lang);
          if (s.day3_date) document.getElementById('d3').textContent = formatDate(s.day3_date, lang);
          if (s.final_place_ru || s.final_place_ky) {
            document.getElementById('finalPlace').textContent = lang === 'ky' ? (s.final_place_ky || '') : (s.final_place_ru || '');
          }
        }
      } catch (e) { console.warn('settings load failed', e); }
    }
    
    function getCategoryClass(title = '') {
      const lower = title.toLowerCase();
      if (lower.includes('–∫—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω') || lower.includes('—Ç–∞–Ω—É—É') || lower.includes('—Ç–∞–∞–Ω—É—É')) {
        return 'category-kyrgyzstan';
      }
      if (lower.includes('—Ç–∞—Ä—ã—Ö') || lower.includes('–∏—Å—Ç–æ—Ä–∏—è') || lower.includes('history')) {
        return 'category-history';
      }
      if (lower.includes('–∏–ª–∏–º') || lower.includes('–Ω–∞—É–∫–∞') || lower.includes('—Ç–µ—Ö–Ω–æ–ª–æ–≥') || lower.includes('science')) {
        return 'category-science';
      }
      if (lower.includes('—Ç–∏–ª') || lower.includes('—è–∑—ã–∫') || lower.includes('–∞–¥–∞–±–∏—è—Ç') || lower.includes('–ª–∏—Ç–µ—Ä–∞—Ç') || lower.includes('language')) {
        return 'category-language';
      }
      if (lower.includes('–¥“Ø–π–Ω”©–ª“Ø–∫') || lower.includes('–º–∏—Ä–æ–≤') || lower.includes('world')) {
        return 'category-world';
      }
      return 'category-default';
    }

    let categoriesCache = null; // Cache categories to prevent disappearing
    
    async function renderCategories() {
      // Wait for AkylI18n to be available
      if (typeof AkylI18n === 'undefined') {
        console.warn('AkylI18n not loaded yet, retrying...');
        setTimeout(() => renderCategories(), 100);
        return;
      }
      
      const lang = AkylI18n.getLang();
      const grid = document.getElementById('catsGrid');
      const list = document.getElementById('cats-list');
      
      if (!grid) {
        console.error('catsGrid element not found');
        return;
      }
      
      if (!list) {
        console.warn('cats-list element not found (may be optional)');
      }
      
      try {
        console.log('Fetching categories from /api/categories...');
        const response = await fetch('/api/categories');
        if (!response.ok) {
          console.error('Failed to fetch categories:', response.status, response.statusText);
          // Use cached categories if available
          if (categoriesCache && categoriesCache.length > 0) {
            console.log('Using cached categories');
            renderCategoriesFromData(categoriesCache, lang, grid, list);
          } else {
            grid.innerHTML = '<p style="text-align:center;color:#ef4444;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.</p>';
          }
          return;
        }
        const cats = await response.json();
        console.log('Categories received:', cats);
        
        if (!Array.isArray(cats)) {
          console.error('Invalid response format, expected array, got:', typeof cats);
          if (categoriesCache && categoriesCache.length > 0) {
            renderCategoriesFromData(categoriesCache, lang, grid, list);
          }
          return;
        }
        
        if (cats.length === 0) {
          console.warn('No categories found in database');
          grid.innerHTML = '<p style="text-align:center;color:#6b7280;">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã.</p>';
          if (list) list.innerHTML = '<ul></ul>';
          return;
        }
        
        // Cache successful response
        categoriesCache = cats;
        renderCategoriesFromData(cats, lang, grid, list);
        console.log('Categories rendered successfully');
      } catch (e) { 
        console.error('categories load failed', e);
        // Use cached categories if available
        if (categoriesCache && categoriesCache.length > 0) {
          console.log('Using cached categories after error');
          renderCategoriesFromData(categoriesCache, lang, grid, list);
        } else {
          grid.innerHTML = '<p style="text-align:center;color:#ef4444;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: ' + e.message + '</p>';
          // Retry after a short delay
          setTimeout(() => {
            renderCategories();
          }, 2000);
        }
      }
    }
    
    function renderCategoriesFromData(cats, lang, grid, list) {
      if (!cats || !Array.isArray(cats) || cats.length === 0) {
        console.warn('renderCategoriesFromData: invalid or empty categories');
        return;
      }
      
      if (!grid) {
        console.error('renderCategoriesFromData: grid element not found');
        return;
      }
      
      try {
        grid.innerHTML = cats.map((c, idx) => {
          const title = lang === 'ky' ? (c.name_ky || c.name_ru || '') : (c.name_ru || '');
          const desc = lang === 'ky' ? (c.desc_ky || c.desc_ru || '') : (c.desc_ru || '');
          const categoryClass = getCategoryClass(title);
          let extraElements = '';
          if (categoryClass === 'category-kyrgyzstan' || categoryClass === 'category-history' || categoryClass === 'category-science' || categoryClass === 'category-language' || categoryClass === 'category-world') {
            extraElements = '<div class="category-border-ornament"></div>';
          }
          return `<div class="category-card ${categoryClass}" data-cat-index="${idx}">${extraElements}<h4>${title}</h4><p>${desc}</p></div>`;
        }).join('');
        
        if (list) {
          list.innerHTML = '<ul>' + cats.map(c => {
            const title = lang === 'ky' ? (c.name_ky || c.name_ru || '') : (c.name_ru || '');
            return `<li>${title}</li>`;
          }).join('') + '</ul>';
        }
      } catch (e) {
        console.error('Error rendering categories:', e);
        grid.innerHTML = '<p style="text-align:center;color:#ef4444;">–û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π</p>';
      }
    }
    
    // Wait for DOM and i18n to be ready
    function initApp() {
      if (typeof AkylI18n === 'undefined') {
        setTimeout(initApp, 50);
        return;
      }
      
      // Ensure language switcher is initialized
      if (AkylI18n.initSwitcher) {
        try {
          AkylI18n.initSwitcher();
        } catch (e) {
          console.warn('Failed to init language switcher:', e);
        }
      }
      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          renderSettings();
          renderCategories();
        });
      } else {
        renderSettings();
        renderCategories();
      }
    }
    
    initApp();
    
    window.addEventListener('akyl-langchange', () => {
      if (typeof AkylI18n !== 'undefined') {
        AkylI18n.applyI18n(AkylI18n.getLang());
        renderSettings();
        renderCategories();
      }
    });

    class Carousel {
      constructor(element) {
        this.element = element;
        this.items = element.querySelectorAll('.carousel-item');
        this.prevBtn = element.querySelector('.carousel-prev');
        this.nextBtn = element.querySelector('.carousel-next');
        this.dotsContainer = element.querySelector('.carousel-dots');
        this.currentIndex = 0;
        this.touchStartX = 0;
        this.touchEndX = 0;
        this.autoplayInterval = null;
        this.autoplayDelay = 5000;

        this.init();
      }

      init() {
        this.createNavigation();
        this.showSlide(0);

        this.prevBtn.addEventListener('click', () => {
          this.prev();
          this.resetAutoplay();
        });
        this.nextBtn.addEventListener('click', () => {
          this.next();
          this.resetAutoplay();
        });
        
        this.element.addEventListener('touchstart', (e) => {
          this.handleTouchStart(e);
        }, false);
        this.element.addEventListener('touchend', (e) => {
          this.handleTouchEnd(e);
        }, false);

        this.element.addEventListener('mouseenter', () => {
          this.stopAutoplay();
        });
        this.element.addEventListener('mouseleave', () => {
          this.startAutoplay();
        });

        this.startAutoplay();
      }

      createNavigation() {
        this.dotsContainer.innerHTML = '';
        
        const prevDot = document.createElement('button');
        prevDot.className = 'carousel-dot carousel-dot-prev';
        prevDot.textContent = '‚Üê';
        this.dotsContainer.appendChild(prevDot);

        const nextDot = document.createElement('button');
        nextDot.className = 'carousel-dot carousel-dot-next';
        nextDot.textContent = '‚Üí';
        this.dotsContainer.appendChild(nextDot);
      }

      showSlide(index) {
        this.items.forEach((item, i) => {
          item.style.display = i === index ? 'flex' : 'none';
          item.style.opacity = i === index ? '1' : '0';
          item.style.transition = 'opacity 0.6s ease-in-out';
        });
        this.currentIndex = index;
      }

      next() {
        const nextIndex = (this.currentIndex + 1) % this.items.length;
        this.showSlide(nextIndex);
      }

      prev() {
        const prevIndex = (this.currentIndex - 1 + this.items.length) % this.items.length;
        this.showSlide(prevIndex);
      }

      handleTouchStart(e) {
        this.touchStartX = e.changedTouches[0].screenX;
      }

      handleTouchEnd(e) {
        this.touchEndX = e.changedTouches[0].screenX;
        this.handleSwipe();
      }

      handleSwipe() {
        const diff = this.touchStartX - this.touchEndX;
        const threshold = 50;

        if (Math.abs(diff) > threshold) {
          if (diff > 0) {
            this.next();
          } else {
            this.prev();
          }
          this.resetAutoplay();
        }
      }

      startAutoplay() {
        this.autoplayInterval = setInterval(() => {
          this.next();
        }, this.autoplayDelay);
      }

      stopAutoplay() {
        if (this.autoplayInterval) {
          clearInterval(this.autoplayInterval);
          this.autoplayInterval = null;
        }
      }

      resetAutoplay() {
        this.stopAutoplay();
        this.startAutoplay();
      }
    }

    const carousel = new Carousel(document.querySelector('.gallery-carousel'));
  </script>
</body>
</html>
